(function(){'use strict';var a={isLoading:!0,visibleCards:{},selectedCities:[],spinner:document.querySelector('.loader'),cardTemplate:document.querySelector('.cardTemplate'),container:document.querySelector('.main'),addDialog:document.querySelector('.dialog-container'),daysOfWeek:['Mon','Tue','Wed','Thu','Fri','Sat','Sun']};localforage.config({name:'myFirstPWA',version:1,description:'storage for the google dev weather PWA'}),document.getElementById('butRefresh').addEventListener('click',function(){a.updateForecasts()}),document.getElementById('butAdd').addEventListener('click',function(){a.toggleAddDialog(!0)}),document.getElementById('butAddCity').addEventListener('click',function(){var c=document.getElementById('selectCityToAdd'),d=c.options[c.selectedIndex],e=d.value,f=d.textContent;a.selectedCities||(a.selectedCities=[]),a.getForecast(e,f),a.selectedCities.push({key:e,label:f}),a.saveSelectedCities(),a.toggleAddDialog(!1)}),document.getElementById('butAddCancel').addEventListener('click',function(){a.toggleAddDialog(!1)}),a.toggleAddDialog=function(c){c?a.addDialog.classList.add('dialog-container--visible'):a.addDialog.classList.remove('dialog-container--visible')},a.updateForecastCard=function(c){var d=new Date(c.created),e=c.channel.astronomy.sunrise,f=c.channel.astronomy.sunset,g=c.channel.item.condition,h=c.channel.atmosphere.humidity,j=c.channel.wind,k=a.visibleCards[c.key];k||(k=a.cardTemplate.cloneNode(!0),k.classList.remove('cardTemplate'),k.querySelector('.location').textContent=c.label,k.removeAttribute('hidden'),a.container.appendChild(k),a.visibleCards[c.key]=k);var l=k.querySelector('.card-last-updated'),m=l.textContent;if(!(m&&(m=new Date(m),d.getTime()<m.getTime()))){l.textContent=c.created,k.querySelector('.description').textContent=g.text,k.querySelector('.date').textContent=g.date,k.querySelector('.current .icon').classList.add(a.getIconClass(g.code)),k.querySelector('.current .temperature .value').textContent=Math.round(g.temp),k.querySelector('.current .sunrise').textContent=e,k.querySelector('.current .sunset').textContent=f,k.querySelector('.current .humidity').textContent=Math.round(h)+'%',k.querySelector('.current .wind .value').textContent=Math.round(j.speed),k.querySelector('.current .wind .direction').textContent=j.direction;var n=k.querySelectorAll('.future .oneday'),o=new Date;o=o.getDay();for(var p=0;7>p;p++){var q=n[p],r=c.channel.item.forecast[p];r&&q&&(q.querySelector('.date').textContent=a.daysOfWeek[(p+o)%7],q.querySelector('.icon').classList.add(a.getIconClass(r.code)),q.querySelector('.temp-high .value').textContent=Math.round(r.high),q.querySelector('.temp-low .value').textContent=Math.round(r.low))}a.isLoading&&(a.spinner.setAttribute('hidden',!0),a.container.removeAttribute('hidden'),a.isLoading=!1)}},a.getForecast=function(c,d){var f='https://query.yahooapis.com/v1/public/yql?format=json&q='+('select * from weather.forecast where woeid='+c);'caches'in window&&caches.match(f).then(function(h){h&&h.json().then(function(k){var l=k.query.results;l.key=c,l.label=d,l.created=k.query.created,a.updateForecastCard(l)})});var g=new XMLHttpRequest;g.onreadystatechange=function(){if(!(g.readyState===XMLHttpRequest.DONE))a.updateForecastCard(b);else if(200===g.status){var h=JSON.parse(g.response),j=h.query.results;j.key=c,j.label=d,j.created=h.query.created,a.updateForecastCard(j)}},g.open('GET',f),g.send()},a.updateForecasts=function(){var c=Object.keys(a.visibleCards);c.forEach(function(d){a.getForecast(d)})},a.saveSelectedCities=function(){localforage.setItem('selectedCities',a.selectedCities).then(function(){console.log('Saved cities to device storage!')}).catch(function(c){console.log(`Error saving cities: ${c.message}`)})},a.getIconClass=function(c){return c=parseInt(c),25===c||32===c||33===c||34===c||36===c||3200===c?'clear-day':0===c||1===c||2===c||6===c||8===c||9===c||10===c||11===c||12===c||17===c||35===c||40===c?'rain':3===c||4===c||37===c||38===c||39===c||45===c||47===c?'thunderstorms':5===c||7===c||13===c||14===c||16===c||18===c||41===c||42===c||43===c||46===c?'snow':15===c||19===c||20===c||21===c||22===c?'fog':24===c||23===c?'windy':26===c||27===c||28===c||31===c?'cloudy':29===c||30===c||44===c?'partly-cloudy-day':void 0};var b={key:'2459115',label:'New York, NY',created:'2016-07-22T01:00:00Z',channel:{astronomy:{sunrise:'5:43 am',sunset:'8:21 pm'},item:{condition:{text:'Windy',date:'Thu, 21 Jul 2016 09:00 PM EDT',temp:56,code:24},forecast:[{code:44,high:86,low:70},{code:44,high:94,low:73},{code:4,high:95,low:78},{code:24,high:75,low:89},{code:24,high:89,low:77},{code:44,high:92,low:79},{code:44,high:89,low:77}]},atmosphere:{humidity:56},wind:{speed:25,direction:195}}};localforage.getItem('selectedCities').then(c=>{c?(a.selectedCities=c,a.selectedCities.forEach(d=>{a.getForecast(d.key,d.label)})):(a.updateForecastCard(b),a.selectedCities=[{key:b.key,label:b.label}],a.saveSelectedCities())}).catch(c=>{console.log(`Error retrieving cities from device storage: ${c.message}`)}),'serviceWorker'in navigator&&navigator.serviceWorker.register('./service-worker.js').then(()=>{console.log('[ServiceWorker] Registered')})})();